//////////////////////////ОтгрузкаГП
Процедура ПробитьЧекНаККМ() 
	
	Если (Проведен() = 0) ИЛИ (ЧекПробитККМ = 1) Тогда
		
		Сообщить("Не удалось пробить чек по документу: " + НомерДок);
		
		Возврат;
		
	КонецЕсли;
	          
	СписокТоваров = СоздатьОбъект("ТаблицаЗначений");
	СписокТоваров.НоваяКолонка("ТовНаим"   , "Строка");
	СписокТоваров.НоваяКолонка("Цена"      , "Число");
	СписокТоваров.НоваяКолонка("Количество", "Число");
	СписокТоваров.НоваяКолонка("Сумма"	   , "Число");
	СписокТоваров.НоваяКолонка("СтавкаНДС" , "Строка");
	СписокТоваров.НоваяКолонка("ПризнакСпособаРасчета"  , "Строка");
	СписокТоваров.НоваяКолонка("ПризнакПредметаРасчета" , "Строка");
	
	ВыбратьСтроки();
	
	Пока ПолучитьСтроку() = 1 Цикл
		
		Если (Найти(Товар.Наименование,"Пакеты") <> 0) ИЛИ (ПустоеЗначение(Цена) = 1) Тогда 
			
			Продолжить;
			
		КонецЕсли;
		
		СписокТоваров.НоваяСтрока();
		
		СписокТоваров.ТовНаим = Товар.Наименование;

		СписокТоваров.Количество = ВсегоКоличество;
		
		СписокТоваров.Цена = Всего/ВсегоКоличество;
		
		СписокТоваров.Сумма	     = Всего;
		
		СтавкаНДС  = Товар.СтавкаНДС.Получить(ДатаДок);
		
		Если СокрЛП(СтавкаНДС.Наименование) = "18%" Тогда
			СписокТоваров.СтавкаНДС = "18";
		ИначеЕсли СокрЛП(СтавкаНДС.Наименование) = "10%" Тогда
			СписокТоваров.СтавкаНДС = "10";
		ИначеЕсли СокрЛП(СтавкаНДС.Наименование) = "Без налога (НДС)" Тогда 
			СписокТоваров.СтавкаНДС = "none";
		КонецЕсли; 

		СписокТоваров.ПризнакСпособаРасчета  = "4";
		
		СписокТоваров.ПризнакПредметаРасчета = "1";
		
	КонецЦикла;
	
	ПризнВозврата =	0;
     
	КассирФИО = ПолноеИмяПользователя();
	
	ТекстВЧеке = СоздатьОбъект("СписокЗначений");
	ТекстВЧеке.ДобавитьЗначение("Документ номер: " + НомерДок);
	ТекстВЧеке.ДобавитьЗначение("Контрагент: " + Контрагент.Наименование);
	
	Параметры = СоздатьОбъект("СписокЗначений");
	Параметры.Установить("Процесс"           , "печатать_чек");
	Параметры.Установить("СписокТоваров"     , СписокТоваров);	                                                         
	Параметры.Установить("СуммаНаличными"    , Итог("Всего"));
	Параметры.Установить("Возврат"           , ПризнВозврата);
	Параметры.Установить("КассирФИО" 		 , КассирФИО);
	Параметры.Установить("КонтактКлиента"    , КонтактКлиента);
	Параметры.Установить("НомерСекции"       , "1");
	Параметры.Установить("ТекстВЧеке"    , ТекстВЧеке);
	
	ОткрытьФормуМодально("Отчет", Параметры, КаталогИБ() + "ONLINE-54.ert");
	
	Если Параметры.Получить("Результат") = 1 Тогда
		
		ДатаЗапретаРедактирования = Константа.ДатаЗапретаРедактирования;
		
		Константа.ДатаЗапретаРедактирования = ДатаДок - 1;
		
		ЧекПробитККМ = 1;
		
		Записать();
		
		Константа.ДатаЗапретаРедактирования = ДатаЗапретаРедактирования; 
		
	ИначеЕсли Параметры.Получить("Результат") = 0 Тогда
		
		Сообщить(Параметры.Получить("ОписаниеРезультата"));
		
	КонецЕсли;

КонецПроцедуры //ПробитьЧекНаККМ()

Процедура УбратьПометкуККМ()
	
	ДатаЗапретаРедактирования = Константа.ДатаЗапретаРедактирования;
	
	Константа.ДатаЗапретаРедактирования = ДатаДок - 1;
	
	ЧекПробитККМ = 0;
	
	Записать();
	
	Константа.ДатаЗапретаРедактирования = ДатаЗапретаРедактирования;
	
КонецПроцедуры //УбратьПометкуККМ()
//////////////////////////////////////////Чек
Процедура ПриемАванса()
	
	СписокТоваров = СоздатьОбъект("ТаблицаЗначений");
	СписокТоваров.НоваяКолонка("ТовНаим"   , "Строка");
	СписокТоваров.НоваяКолонка("Цена"      , "Число");
	СписокТоваров.НоваяКолонка("Количество", "Число");
	СписокТоваров.НоваяКолонка("Сумма"	   , "Число");
	СписокТоваров.НоваяКолонка("СтавкаНДС" , "Строка");
	СписокТоваров.НоваяКолонка("ПризнакСпособаРасчета" , "Строка");
	СписокТоваров.НоваяКолонка("ПризнакПредметаРасчета" , "Строка");
	
	СписокТоваров.НоваяСтрока();
	СписокТоваров.ТовНаим    = "Оплата от: " + Субконто1.ПолнНаименование + " .Основание: " + ДвижениеДенежныхСредств.Наименование;
	СписокТоваров.Цена       = Сумма;
	СписокТоваров.Количество = 1; 
	СписокТоваров.Сумма		 = Сумма;
	СписокТоваров.СтавкаНДС  = Константа.АвансНДС;
	СписокТоваров.ПризнакСпособаРасчета = "3";
	СписокТоваров.ПризнакПредметаРасчета = "10";
	
	КассирФИО = ПолноеИмяПользователя();
	ЧекНаВозврат = 0;

	Параметры = СоздатьОбъект("СписокЗначений");
	
	Параметры.Установить("Процесс"          , "печатать_чек");
	Параметры.Установить("СписокТоваров"    , СписокТоваров);
	Параметры.Установить("КассирФИО" 		, КассирФИО);
	Параметры.Установить("Возврат" 	        , ЧекНаВозврат);
	Параметры.Установить("СуммаНаличными"   , Сумма);
	Параметры.Установить("НомерСекции"      , "2");
	
	ОткрытьФормуМодально("Отчет", Параметры, КаталогИБ() + "ONLINE-54.ert");
	
КонецПроцедуры